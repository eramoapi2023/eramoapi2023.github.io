"0",""
"0","#library(RPostgreSQL)"
"0","#drv <- dbDriver(""PostgreSQL"")"
"0","#conn <- dbConnect(drv,dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"")"
"0",""
"0","datos <- dbGetQuery(conn,""select producto, round(sum(ton_estimada), 2) ton_inicial, round(sum(ton_final), 2) ton_final, round(sum(diferencia), 2) diferencia"
"0","from"
"0","	(select b.descrip producto, sum(ton_estimada_a) ton_estimada, sum(ton_final_a) ton_final, sum(ton_final_a - ton_estimada_a) diferencia"
"0","  	from explotacion.productos_agricola a join catalogos.prod_agricola b on a.producto_a = b.gid"
"0","  	 where a.producto_a not in (901, 902, 903)"
"0","  	group by producto"
"0","union"
"0","  	select nom_otro_producto_a producto, sum(ton_estimada_a) ton_estimada, sum(ton_final_a) ton_final, sum(ton_final_a - ton_estimada_a) diferencia"
"0","  	from explotacion.productos_agricola"
"0","  	where producto_a = 901 and nom_otro_producto_a <> 'NE'"
"0","  	group by producto"
"0","union"
"0","  	select nom_otro_producto_a producto, sum(ton_estimada_a) ton_estimada, sum(ton_final_a) ton_final, sum(ton_final_a - ton_estimada_a) diferencia"
"0","  	from explotacion.productos_agricola"
"0","  	where producto_a = 902 and nom_otro_producto_a <> 'NE'"
"0","  	group by producto"
"0","union"
"0","  	select nom_otro_producto_a producto, sum(ton_estimada_a) ton_estimada, sum(ton_final_a) ton_final, sum(ton_final_a - ton_estimada_a) diferencia"
"0","  	from explotacion.productos_agricola"
"0","  	where producto_a = 903"
"0","  	group by producto) as query"
"0","group by producto"
"0","order by ton_inicial desc, ton_final desc"");"
"0",""
"0","library(plotly)"
"0","data <- datos[,c('producto', 'ton_inicial', 'ton_final')]"
"0","fig <- plot_ly(data, x = ~producto, y = ~ton_inicial, type = 'bar', name = 'Toneladas esperadas',"
"0","               marker = list(color = '#68912B'))"
"0","fig <- fig %>% add_trace(y = ~ton_final, name = 'Toneladas cosechadas',"
"0","              marker = list(color = '#AB7A5A'))"
"0",""
"0","fig <- fig %>% layout(title=(""""),"
"0","xaxis = list(title = ""Producto"", categoryorder = ""total descending""),"
"0","yaxis = list(title = ""Tonelada"", barmode = 'group'))"
"0",""
"0","#1.8. Cosecha esperada vs. Cosecha final de los productos agr√≠colas reportados"
"0","#dbDisconnect(conn)"
"0",""
"0","fig"
