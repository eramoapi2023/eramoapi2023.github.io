"0",""
"0","#library(RPostgreSQL)"
"0",""
"0","#drv <- dbDriver(""PostgreSQL"")"
"0","#conn <- dbConnect(drv,dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"")"
"0",""
"0","datos <- dbGetQuery(conn,""select destino, round(ton_perdida*100/(select sum(ton_perd_a) from explotacion.perdida_agricola),2) porc"
"0","from("
"0","	Select b.descrip destino, round(sum(ton_perd_a),2) ton_perdida"
"0","	From explotacion.perdida_agricola a "
"0","	join catalogos.destino_agricola b"
"0","	on a.destino_perd_a = b.id"
"0","	group by b.descrip, b.id"
"0",")as query"
"0","order by porc desc;"")"
"0",""
"0","library(plotly)"
"0","data <- datos[,c('destino', 'porc')]"
"0","fig <- plot_ly(data, x = ~destino, y = ~porc, type = 'bar',"
"0","      marker = list(color = '#AB7A5A'))  "
"0","     #'rgb(33, 97, 140)', 'rgb(33, 97, 140)'"
"0","fig <- fig %>% layout(title=(""Destino de la pérdida de alimentos Agrícolas""),"
"0","xaxis = list(title = ""Destino"", categoryorder = ""total descending""),"
"0","yaxis = list(title = ""Porcentaje""))"
"0",""
"0","#dbDisconnect(conn)"
"0",""
"0","fig"
