"0",""
"0","#library(RPostgreSQL) "
"0","#drv <- dbDriver(""PostgreSQL"") "
"0","#conn <- dbConnect(drv,dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"") "
"0",""
"0","datos <- dbGetQuery(conn,""Select causa, frec, total, perdida2, round(perdida2/total*100, 1) porc"
"0"," from"
"0","  (select causa, frec, total, round(perdida/1000,0) perdida2"
"0","from"
"0"," (select *, (select sum(perdida_kg_e)/1000 from explotacion.productos_establecimientos where causa_perd_e <>11) as total"
"0","    from"
"0","    (select b.descrip causa, count(*) frec, round(sum(perdida_kg_e),3) perdida"
"0","     from explotacion.productos_establecimientos a"
"0","     join catalogos.cat_causas b"
"0","     on a.causa_perd_e = b.gid"
"0","     where a.causa_perd_e <>11"
"0","     group by b.descrip"
"0","     order by perdida desc"
"0","	 ) as query"
"0",") as query2"
"0","   ) as query3"
"0","order by porc desc;"") "
"0",""
"0",""
"0",""
"0","library(plotly)"
"0","data <- datos[,c('causa', 'porc')]"
"0","fig <- plot_ly(data, x = ~causa, y = ~porc, type = 'bar',"
"0","      marker = list(color = '#68912B'))  "
"0","     #'rgb(33, 97, 140)', 'rgb(155, 200, 200)'"
"0","fig <- fig %>% layout(title=(""""),"
"0","xaxis = list(title = ""Destino"", categoryorder = ""total descending""),"
"0","yaxis = list(title = ""Porcentaje del desperdicio""))"
"0",""
"0",""
"0","#dbDisconnect(conn)"
"0",""
"0","fig"
