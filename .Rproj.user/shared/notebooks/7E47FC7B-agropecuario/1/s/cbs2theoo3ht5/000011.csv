"0",""
"0","#library(RPostgreSQL)"
"0",""
"0","#drv <- dbDriver(""PostgreSQL"")"
"0","#conn <- dbConnect(drv,dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"")"
"0",""
"0","datos <- dbGetQuery(conn,""select producto, round(sum(ton_perd_a)/sum(ton_final_a)*100,2) porc_perdida"
"0","from"
"0","(select b.descrip producto, c.ton_final_a, a.ton_perd_a"
"0","	from explotacion.perdida_agricola a"
"0","	join catalogos.prod_agricola b"
"0","	on a.producto_a = b.gid"
"0","	join explotacion.productos_agricola c"
"0","	on a.id_agrop = c.id_agrop and a.producto_a = c.producto_a"
"0","	where b.descrip not in ('Otro producto 1','Otro producto 2','Otro producto 3')"
"0","union all"
"0","	select c.nom_otro_producto_a producto, c.ton_final_a, a.ton_perd_a"
"0","	from explotacion.perdida_agricola a"
"0","	join explotacion.productos_agricola c"
"0","	on a.id_agrop = c.id_agrop and a.producto_a = c.producto_a "
"0","	where c.producto_a in ('901','902','903')"
"0","	order by ton_perd_a"
"0",") as query"
"0","group by producto"
"0","order by porc_perdida"");"
"0",""
"0","library(plotly)"
"0","data <- datos[,c('producto', 'porc_perdida')]"
"0","fig <- plot_ly(data, x = ~producto, y = ~porc_perdida, type = 'bar',"
"0","      marker = list(color = '#68912B'))  "
"0","#'rgb(214, 234, 250)', 'rgb(155, 200, 200)'"
"0","fig <- fig %>% layout(title=(""2.1.3.a. Porcentaje de p√©rdida por producto alimenticio (agrupado).""),"
"0","xaxis = list(title = ""Producto"", categoryorder = ""total descending""),"
"0","yaxis = list(title = ""Porcentaje""))"
"0",""
"0","#dbDisconnect(conn)"
"0",""
"0","fig"
