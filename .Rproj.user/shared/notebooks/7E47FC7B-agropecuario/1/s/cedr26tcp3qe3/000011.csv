"0",""
"0","#library(RPostgreSQL)"
"0",""
"0","#drv <- dbDriver(""PostgreSQL"")"
"0","#conn <- dbConnect(drv,dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"")"
"0",""
"0","datos <- dbGetQuery(conn,""select producto, round((sum(perdida)/sum(manejo))*100, 2) porc_perdida"
"0","From (Select c.descrip producto, b.ton_final_p manejo, ton_perd_p perdida"
"0","  from explotacion.perdida_pecuario a"
"0","  join explotacion.productos_pecuario b"
"0","    on a.id_agrop = b.id_agrop and a.producto_p = b.producto_p"
"0","  join catalogos.prod_pecuario c"
"0","    on a.producto_p = c.gid"
"0","  where a.producto_p not in (991, 992, 993)"
"0","union all"
"0","  Select a.nom_otro_producto_p producto, b.ton_final_p manejo, ton_perd_p perdida"
"0","  From explotacion.perdida_pecuario a"
"0","  join explotacion.productos_pecuario b"
"0","    on a.id_agrop = b.id_agrop and a.producto_p = b.producto_p"
"0","  where a.producto_p = 991"
"0","union all"
"0","  Select a.nom_otro_producto_p producto, b.ton_final_p manejo, ton_perd_p perdida"
"0","  From explotacion.perdida_pecuario a"
"0","  join explotacion.productos_pecuario b"
"0","    on a.id_agrop = b.id_agrop and a.producto_p = b.producto_p"
"0","  where a.producto_p = 992"
"0","union all"
"0","  Select a.nom_otro_producto_p producto, b.ton_final_p manejo, ton_perd_p perdida"
"0","  From explotacion.perdida_pecuario a"
"0","  join explotacion.productos_pecuario b"
"0","    on a.id_agrop = b.id_agrop and a.producto_p = b.producto_p"
"0","  where a.producto_p = 993) as query"
"0","group by producto"
"0","order by porc_perdida"");"
"0",""
"0","library(plotly)"
"0","data <- datos[,c('producto', 'porc_perdida')]"
"0","fig <- plot_ly(data, x = ~producto, y = ~porc_perdida, type = 'bar', "
"0","marker = list(color = '#68912B'))"
"0",""
"0","fig <- fig %>% layout(title=(""3.1.3.a. Porcentaje de p√©rdida por producto alimenticio (agrupado)""),"
"0","xaxis = list(title = ""Producto"", categoryorder = ""total descending""),"
"0","yaxis = list(title = ""Porcentaje""))"
"0",""
"0","#dbDisconnect(conn)"
"0",""
"0","fig"
