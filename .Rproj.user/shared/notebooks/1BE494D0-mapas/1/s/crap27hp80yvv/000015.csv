"0",""
"0",""
"0","knitr::opts_chunk$set(echo=FALSE, message = FALSE, warning = FALSE)"
"0",""
"0",""
"0","library(RPostgreSQL)"
"0","library(rgeos)"
"0","library(sp)"
"0","library(rgdal)"
"0","library(leaflet)"
"0","library(leaflet.extras)"
"0","library(mapview)"
"0","library(htmltools)"
"0","library(htmlwidgets)"
"0",""
"0",""
"0","conn <- dbConnect(dbDriver(""PostgreSQL""), dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"")"
"0",""
"0","datos <- dbGetQuery(conn,""select *, st_astext(centroide) as point from public.super_establecimientos"")"
"0",""
"0","datos1 <- datos[which(datos$tipo_medidas==""Administrar la oferta - costo - demanda""),]"
"0","datos2 <- datos[which(datos$tipo_medidas==""Aplicar mantenimiento y actualización de maquinaria ""),]"
"0","datos3 <- datos[which(datos$tipo_medidas==""Aprovechar los residuos para otros fines ""),]"
"0","datos4 <- datos[which(datos$tipo_medidas==""Concientizar sobre la PDA ""),]"
"0","datos5 <- datos[which(datos$tipo_medidas==""Manejar buenas prácticas""),]"
"0","datos6 <- datos[which(datos$tipo_medidas==""Planear una justa y adecuada compra y preparación de productos""),]"
"0","datos7 <- datos[which(datos$tipo_medidas==""Otras medidas""),]"
"0",""
"0",""
"0","res <- dbDisconnect(conn)"
"0",""
"0","#row.names(datos) = datos$nom_ent"
"0",""
"0","#row.names(datos) = datos$producto"
"0",""
"0","## Load projections"
"0","EPSG <- make_EPSG()"
"0","p4s <- EPSG[which(EPSG$code == 4326), ""prj4""]"
"0",""
"0",""
"0","# Create polygons from WKT"
"0",""
"0","sp_obj1 <- datos1 %$%"
"0","mapply(rgeos::readWKT, id = id_estab, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj2 <- datos2 %$%"
"0","mapply(rgeos::readWKT, id = id_estab, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj3 <- datos3 %$%"
"0","mapply(rgeos::readWKT, id = id_estab, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj4 <- datos4 %$%"
"0","mapply(rgeos::readWKT, id = id_estab, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj5 <- datos5 %$%"
"0","mapply(rgeos::readWKT, id = id_estab, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj6 <- datos6 %$%"
"0","mapply(rgeos::readWKT, id = id_estab, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj7 <- datos7 %$%"
"0","mapply(rgeos::readWKT, id = id_estab, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0",""
"0","## Create SpatialPolygonsDataFrame"
"0",""
"0","sp_df1 = SpatialPointsDataFrame(sp_obj1, datos1[-2])"
"0","sp_df1$key <- factor(sp_df1$id_estab)"
"0","datos1$key <- factor(datos1$id_estab)"
"0",""
"0","sp_df2 = SpatialPointsDataFrame(sp_obj2, datos2[-2])"
"0","sp_df2$key <- factor(sp_df2$id_estab)"
"0","datos2$key <- factor(datos2$id_estab)"
"0",""
"0","sp_df3 = SpatialPointsDataFrame(sp_obj3, datos3[-2])"
"0","sp_df3$key <- factor(sp_df3$id_estab)"
"0","datos3$key <- factor(datos3$id_estab)"
"0",""
"0","sp_df4 = SpatialPointsDataFrame(sp_obj4, datos4[-2])"
"0","sp_df4$key <- factor(sp_df4$id_estab)"
"0","datos4$key <- factor(datos4$id_estab)"
"0",""
"0","sp_df5 = SpatialPointsDataFrame(sp_obj5, datos5[-2])"
"0","sp_df5$key <- factor(sp_df5$id_estab)"
"0","datos5$key <- factor(datos5$id_estab)"
"0",""
"0","sp_df6 = SpatialPointsDataFrame(sp_obj6, datos6[-2])"
"0","sp_df6$key <- factor(sp_df6$id_estab)"
"0","datos6$key <- factor(datos6$id_estab)"
"0",""
"0","sp_df7 = SpatialPointsDataFrame(sp_obj7, datos7[-2])"
"0","sp_df7$key <- factor(sp_df7$id_estab)"
"0","datos7$key <- factor(datos7$id_estab)"
"0",""
"0",""
"0","## pal <- colorFactor(rainbow(15), levels = levels(datos$interview__key), na.color = ""white"")"
"0",""
"0",""
"0","m <- leaflet() %>% "
"0","  "
"0","  #addTiles(group = ""OSM"") %>% "
"0","  addProviderTiles(""CartoDB.Positron"", group = ""Carto"") %>%"
"0","  #addProviderTiles(providers$OpenTopoMap, group = ""Topo"") %>%"
"0","  addFullscreenControl()"
"0","m %>% setView(lng = -102.43, lat = 22.37, zoom = 5.4) %>%"
"0",""
"0","  "
"0","  addMarkers(data= sp_df1,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Entidad: </strong>"", sp_df1$nom_ent, ""</br>"","
"0","                           ""<strong>Municipio: </strong>"", sp_df1$nom_mun, ""</br>"""
"0","                           ),"
"0","           group = ""Administrar la oferta - costo - demanda"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df2,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Entidad: </strong>"", sp_df2$nom_ent, ""</br>"","
"0","                           ""<strong>Municipio: </strong>"", sp_df2$nom_mun, ""</br>"""
"0","                           ),"
"0","           group = ""Aplicar mantenimiento y actualización de maquinaria """
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df3,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Entidad: </strong>"", sp_df3$nom_ent, ""</br>"","
"0","                           ""<strong>Municipio: </strong>"", sp_df3$nom_mun, ""</br>""),"
"0","           group = ""Aprovechar los residuos para otros fines """
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df4,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Entidad: </strong>"", sp_df4$nom_ent, ""</br>"","
"0","                           ""<strong>Municipio: </strong>"", sp_df4$nom_mun, ""</br>""),"
"0","           group = ""Concientizar sobre la PDA """
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df5,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Entidad: </strong>"", sp_df5$nom_ent, ""</br>"","
"0","                           ""<strong>Municipio: </strong>"", sp_df5$nom_mun, ""</br>"""
"0","                           ),"
"0","           group = ""Manejar buenas prácticas"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df6,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Entidad: </strong>"", sp_df6$nom_ent, ""</br>"","
"0","                           ""<strong>Municipio: </strong>"", sp_df6$nom_mun, ""</br>"""
"0","                           ),"
"0","           group = ""Planear una justa y adecuada compra y preparación de productos"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df7,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Entidad: </strong>"", sp_df7$nom_ent, ""</br>"","
"0","                           ""<strong>Municipio: </strong>"", sp_df7$nom_mun, ""</br>"""
"0","                           ),"
"0","           group = ""Otras medidas"""
"0","           ) %>%"
"0","  "
"0",""
"0"," "
"0","  addLayersControl(#m,"
"0","                   baseGroups = c(""Administrar la oferta - costo - demanda"", ""Aplicar mantenimiento y actualización de maquinaria "", ""Aprovechar los residuos para otros fines "", ""Concientizar sobre la PDA "", ""Manejar buenas prácticas"", ""Planear una justa y adecuada compra y preparación de productos"", ""Otras medidas"")"
"0","                   #overlayGroups = c(""estabPorc"", ""estabPunt"", ""Unidades donde cuentan con medidas"", ""Productos registrados y sus pérdidas"")"
"0","                   #options = layersControlOptions(collapsed = FALSE)"
"0","                   )"
