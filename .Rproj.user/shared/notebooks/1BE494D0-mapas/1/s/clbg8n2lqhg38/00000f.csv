"0",""
"0",""
"0","knitr::opts_chunk$set(echo=FALSE, message = FALSE, warning = FALSE)"
"0",""
"0",""
"0","library(RPostgreSQL)"
"0","library(rgeos)"
"0","library(sp)"
"0","library(rgdal)"
"0","library(leaflet)"
"0","library(leaflet.extras)"
"0","library(mapview)"
"0","library(htmltools)"
"0","library(htmlwidgets)"
"0",""
"0",""
"0","conn <- dbConnect(dbDriver(""PostgreSQL""), dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"")"
"0",""
"0","datos <- dbGetQuery(conn,""select *, st_astext(centroid) as point from public.super_productos_e"")"
"0",""
"0","datos1 <- datos[which(datos$destino==""Alcantarillado""),]"
"0","datos2 <- datos[which(datos$destino==""Alimentación de animales""),]"
"0","datos3 <- datos[which(datos$destino==""Banco de alimentos""),]"
"0","datos4 <- datos[which(datos$destino==""Basurero / relleno sanitario""),]"
"0","datos5 <- datos[which(datos$destino==""Comedores públicos (organización religiosa, altruista, anexos de rehabilitación de adicciones, orfanatos, entre otros)""),]"
"0","datos6 <- datos[which(datos$destino==""Composteo / procesos aeróbicos""),]"
"0","datos7 <- datos[which(datos$destino==""Consumo propio""),]"
"0","datos8 <- datos[which(datos$destino==""Devolución del producto""),]"
"0","datos9 <- datos[which(datos$destino==""Lo regaló""),]"
"0","datos10 <- datos[which(datos$destino==""Lo vendió""),]"
"0","datos11 <- datos[which(datos$destino==""Reciclaje o reutilización""),]"
"0","datos12 <- datos[which(datos$destino==""Redes alimentarias alternativas (o Circuitos cortos)""),]"
"0","datos13 <- datos[which(datos$destino==""Tratamiento de aguas residuales""),]"
"0","datos14 <- datos[which(datos$destino==""No se pudo determinar""),]"
"0","datos15 <- datos[which(datos$destino==""Otro destino""),]"
"0",""
"0","res <- dbDisconnect(conn)"
"0",""
"0","#row.names(datos) = datos$causa"
"0",""
"0","#row.names(datos) = datos$producto"
"0",""
"0",""
"0","## Load projections"
"0","EPSG <- make_EPSG()"
"0","p4s <- EPSG[which(EPSG$code == 4326), ""prj4""]"
"0",""
"0",""
"0","# Create polygons from WKT"
"0","sp_obj1 <- datos1 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj2 <- datos2 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj3 <- datos3 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj4 <- datos4 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj5 <- datos5 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj6 <- datos6 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj7 <- datos7 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj8 <- datos8 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj9 <- datos9 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj10 <- datos10 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj11 <- datos11 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj12 <- datos12 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj13 <- datos13 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj14 <- datos14 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0","sp_obj15 <- datos15 %$%"
"0","mapply(rgeos::readWKT, id = gid, text = point) %>%"
"0","do.call(sp::rbind.SpatialPoints, .)"
"0",""
"0",""
"0","## Create SpatialPolygonsDataFrame"
"0","sp_df1 = SpatialPointsDataFrame(sp_obj1, datos1[-2])"
"0","sp_df1$key <- factor(sp_df1$gid)"
"0","datos1$key <- factor(datos1$gid)"
"0",""
"0","sp_df2 = SpatialPointsDataFrame(sp_obj2, datos2[-2])"
"0","sp_df2$key <- factor(sp_df2$gid)"
"0","datos2$key <- factor(datos2$gid)"
"0",""
"0","sp_df3 = SpatialPointsDataFrame(sp_obj3, datos3[-2])"
"0","sp_df3$key <- factor(sp_df3$gid)"
"0","datos3$key <- factor(datos3$gid)"
"0",""
"0","sp_df4 = SpatialPointsDataFrame(sp_obj4, datos4[-2])"
"0","sp_df4$key <- factor(sp_df4$gid)"
"0","datos4$key <- factor(datos4$gid)"
"0",""
"0","sp_df5 = SpatialPointsDataFrame(sp_obj5, datos5[-2])"
"0","sp_df5$key <- factor(sp_df5$gid)"
"0","datos5$key <- factor(datos5$gid)"
"0",""
"0","sp_df6 = SpatialPointsDataFrame(sp_obj6, datos6[-2])"
"0","sp_df6$key <- factor(sp_df6$gid)"
"0","datos6$key <- factor(datos6$gid)"
"0",""
"0","sp_df7 = SpatialPointsDataFrame(sp_obj7, datos7[-2])"
"0","sp_df7$key <- factor(sp_df7$gid)"
"0","datos7$key <- factor(datos7$gid)"
"0",""
"0","sp_df8 = SpatialPointsDataFrame(sp_obj8, datos8[-2])"
"0","sp_df8$key <- factor(sp_df8$gid)"
"0","datos8$key <- factor(datos8$gid)"
"0",""
"0","sp_df9 = SpatialPointsDataFrame(sp_obj9, datos9[-2])"
"0","sp_df9$key <- factor(sp_df9$gid)"
"0","datos9$key <- factor(datos9$gid)"
"0",""
"0","sp_df10 = SpatialPointsDataFrame(sp_obj10, datos10[-2])"
"0","sp_df10$key <- factor(sp_df10$gid)"
"0","datos10$key <- factor(datos10$gid)"
"0",""
"0","sp_df11 = SpatialPointsDataFrame(sp_obj11, datos11[-2])"
"0","sp_df11$key <- factor(sp_df11$gid)"
"0","datos11$key <- factor(datos11$gid)"
"0",""
"0","sp_df12 = SpatialPointsDataFrame(sp_obj12, datos12[-2])"
"0","sp_df12$key <- factor(sp_df12$gid)"
"0","datos12$key <- factor(datos12$gid)"
"0",""
"0","sp_df13 = SpatialPointsDataFrame(sp_obj13, datos13[-2])"
"0","sp_df13$key <- factor(sp_df13$gid)"
"0","datos13$key <- factor(datos13$gid)"
"0",""
"0","sp_df14 = SpatialPointsDataFrame(sp_obj14, datos14[-2])"
"0","sp_df14$key <- factor(sp_df14$gid)"
"0","datos14$key <- factor(datos14$gid)"
"0",""
"0","sp_df15 = SpatialPointsDataFrame(sp_obj15, datos15[-2])"
"0","sp_df15$key <- factor(sp_df15$gid)"
"0","datos15$key <- factor(datos15$gid)"
"0",""
"0","## pal <- colorFactor(rainbow(15), levels = levels(datos$interview__key), na.color = ""white"")"
"0",""
"0",""
"0","m <- leaflet() %>% "
"0","  "
"0","  #addTiles(group = ""OSM"") %>% "
"0","  #addProviderTiles(CartoDB.Positron) %>%"
"0","  addProviderTiles(""CartoDB.Positron"", group = ""Carto"") %>%"
"0","  addFullscreenControl()"
"0","m %>% setView(lng = -102.43, lat = 22.37, zoom = 5.4) %>%"
"0","  "
"0","  addMarkers(data= sp_df1,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df1$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df1$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df1$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df1$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df1$causa, ""</br>""),"
"0","           group = ""Alcantarillado"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df2,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df2$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df2$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df2$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df2$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df2$causa, ""</br>""),"
"0","           group = ""Alimentación de animales"""
"0","           ) %>%"
"0",""
"0",""
"0","  addMarkers(data= sp_df3,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df3$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df3$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df3$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df3$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df3$causa, ""</br>""),"
"0","           group = ""Banco de alimentos"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df4,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df4$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df4$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df4$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df4$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df4$causa, ""</br>""),"
"0","           group = ""Basurero / relleno sanitario"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df5,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df5$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df5$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df5$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df5$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df5$causa, ""</br>""),"
"0","           group = ""Comedores públicos (org. religiosa, altruista, anexos de rehab. de adicciones, orfanatos, etc.)"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df6,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df6$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df6$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df6$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df6$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df6$causa, ""</br>""),"
"0","           group = ""Composteo / procesos aeróbicos"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df7,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df7$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df7$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df7$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df7$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df7$causa, ""</br>""),"
"0","           group = ""Consumo propio"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df8,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df8$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df8$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df8$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df8$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df8$causa, ""</br>""),"
"0","           group = ""Devolución del producto"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df9,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df9$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df9$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df9$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df9$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df9$causa, ""</br>""),"
"0","           group = ""Lo regaló"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df10,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df10$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df10$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df10$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df10$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df10$causa, ""</br>""),"
"0","           group = ""Lo vendió"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df11,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df11$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df11$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df11$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df11$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df11$causa, ""</br>""),"
"0","           group = ""Reciclaje o reutilización"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df12,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df12$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df12$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df12$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df12$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df12$causa, ""</br>""),"
"0","           group = ""Redes alimentarias alternativas (o Circuitos cortos)"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df13,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df13$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df13$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df13$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df13$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df13$causa, ""</br>""),"
"0","           group = ""Tratamiento de aguas residuales"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df14,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df14$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df14$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df14$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df14$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df14$causa, ""</br>""),"
"0","           group = ""No se pudo determinar"""
"0","           ) %>%"
"0","  "
"0","  addMarkers(data= sp_df15,"
"0","           clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = T),"
"0","           popup = paste0( ""<strong>Producto: </strong>"", sp_df15$producto, ""</br>"","
"0","                           ""<strong>Otro producto: </strong>"", sp_df15$nom_otro_producto, ""</br>"","
"0","                           ""<strong>Manejo total (kg): </strong>"", sp_df15$manejo_kg, ""</br>"","
"0","                           ""<strong>Desperdicio (kg): </strong>"", sp_df15$perdida_kg, ""</br>"","
"0","                           ""<strong>Causa: </strong>"", sp_df15$causa, ""</br>""),"
"0","           group = ""Otro destino"""
"0","           ) %>%"
"0","  "
"0","  "
"0","  addLayersControl(#m,"
"0","                   baseGroups = c(""Alcantarillado"", ""Alimentación de animales"", ""Banco de alimentos"",""Basurero / relleno sanitario"", ""Comedores públicos (org. religiosa, altruista, anexos de rehab. de adicciones, orfanatos, etc.)"", ""Composteo / procesos aeróbicos"", ""Consumo propio"",""Devolución del producto"", ""Lo regaló"", ""Lo vendió"", ""Reciclaje o reutilización"", ""Redes alimentarias alternativas (o Circuitos cortos)"", ""Tratamiento de aguas residuales"", ""No se pudo determinar"", ""Otro destino"")"
"0","                   #opacity = 0.7"
"0","                   #options = layersControlOptions(collapsed = FALSE)"
"0","                   ) "
