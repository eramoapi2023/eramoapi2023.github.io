"0",""
"0","#library(RPostgreSQL)"
"0","#drv <- dbDriver(""PostgreSQL"")"
"0","#conn <- dbConnect(drv,dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"")"
"0",""
"0","datos <- dbGetQuery(conn,""Select mercado_p, suma_p"
"0","From"
"0","  (select (values ('Mercado minorista'::text)) as mercado_p,"
"0","      (select sum(mercado_min_p)"
"0","       from explotacion.productos_pecuario"
"0","       where mercado_min_p = 100) as suma_p"
"0","union"
"0","  select (values ('Mercado mayorista'::text)) as mercado_p,"
"0","      (select sum(mercado_may_p)"
"0","       from explotacion.productos_pecuario"
"0","       where mercado_may_p = 100) as suma_p"
"0","union"
"0","  select (values ('Mercado entidades gobierno'::text)) as mercado_p,"
"0","      (select sum(mercado_ent_p)"
"0","       from explotacion.productos_pecuario"
"0","       where mercado_ent_p = 100) as suma_p"
"0","union"
"0","  select (values ('Mercado extranjero'::text)) as mercado_p,"
"0","      (select sum(mercado_extr_p)"
"0","       from explotacion.productos_pecuario"
"0","       where mercado_extr_p = 100) as suma_p"
"0","Union	   "
"0","  select (values ('Mercado mixto'::text)) as mercado_p,"
"0","      (select sum(mercado_min_p) + sum(mercado_may_p) + sum(mercado_ent_p) + sum(mercado_extr_p)"
"0","       from explotacion.productos_pecuario"
"0","       where (mercado_min_p <> 100 and mercado_may_p <> 100 and mercado_ent_p <> 100 and mercado_extr_p <> 100)) as suma_p) merc"
"0","Order by mercado_p"");"
"0",""
"0","library(plotly)"
"0",""
"0","data <- datos[,c('mercado_p', 'suma_p')]"
"0","colors <- colorRampPalette(c(""#68912B"",""#AB7A5A""))(5)"
"0","fig <- plot_ly(data, labels = ~mercado_p, values = ~suma_p, type = 'pie',"
"0","textposition = 'outside',"
"0","textinfo = 'percent',"
"0","insidetextfont = list(color = '#FFFFFF'),"
"0","hoverinfo = 'text',"
"0","text = ~paste('',mercado_p , ''),"
"0","marker = list(colors = colors,"
"0","line = list(color = '#FFFFFF', width = 1)), showlegend = TRUE)"
"0",""
"0","fig <- fig %>% layout(title = '',"
"0","xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),"
"0","yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))"
"0",""
"0","#dbDisconnect(conn)"
"0",""
"0","fig"
