"0",""
"0"," "
"0","#library(RPostgreSQL) "
"0","#drv <- dbDriver(""PostgreSQL"") "
"0","#conn <- dbConnect(drv,dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"") "
"0",""
"0",""
"0","datos <- dbGetQuery(conn,""select producto, frec, total, perdida, round(perdida/total*100, 2) porc"
"0","from (select *, (select sum(perdida_kg_e) from explotacion.productos_establecimientos where destino_perd_e = 7) as total"
"0","	  from "
"0","(select nombre_otro_prod producto, count (*) frec, round(sum(perdida_kg_e),3) perdida"
"0","from explotacion.productos_establecimientos "
"0","where destino_perd_e = 7 and nombre_otro_prod is not null and producto_e in (135,136,137)"
"0","group by producto "
"0","union all "
"0","select b.descrip producto, count(*) frec, sum(perdida_kg_e)"
"0","from explotacion.productos_establecimientos  a"
"0","join catalogos.prod_establecimientos b"
"0","on a.producto_e = b.gid"
"0","where b.descrip not in ('Otro producto 1', 'Otro producto 2', 'Otro producto 3') and a.destino_perd_e = 7"
"0","group by b.descrip"
"0","order by frec desc"
"0","    ) as query"
"0",") as query2"
"0","order by porc desc;"") "
"0",""
"0"," library(plotly)"
"0","data <- datos[,c('producto', 'porc')]"
"0","fig <- plot_ly(data, x = ~producto, y = ~porc, type = 'bar',"
"0","      marker = list(color = '#68912B'))  "
"0","     #'rgb(33, 97, 140)', 'rgb(155, 200, 200)'"
"0","fig <- fig %>% layout(title=("" ""),"
"0","xaxis = list(title = ""Producto"", categoryorder = ""total descending""),"
"0","yaxis = list(title = ""Porcentaje""))"
"0","#dbDisconnect(conn)"
"0",""
"0",""
"0","fig"
