"0",""
"0"," "
"0",""
"0","#library(RPostgreSQL) "
"0","#drv <- dbDriver(""PostgreSQL"") "
"0","#conn <- dbConnect(drv,dbname=""bderamo2021_gold"", host=""10.200.31.73"",port=5432,user=""eramo_gold"",password=""ERAMO_GOLD"")"
"0",""
"0","datos <- dbGetQuery(conn,""select producto, sum(manejo) manejo, sum(perdida) perdida, sum(perdida)/1000 perdida_ton, round(sum((perdida))/(sum(manejo))*100,2) porcent_perdida"
"0","from"
"0","("
"0","select b.descrip producto, a.manejo_kg_e manejo, a.perdida_kg_e perdida"
"0","from explotacion.productos_establecimientos a"
"0","join catalogos.prod_establecimientos b"
"0","on a.producto_e = b.gid and b.descrip not in ('Otro producto 1', 'Otro producto 2', 'Otro producto 3')"
"0","union all"
"0","select nombre_otro_prod producto, manejo_kg_e manejo, perdida_kg_e perdida"
"0","from explotacion.productos_establecimientos"
"0","where producto_e in (135, 136, 137)"
"0",") as query"
"0","group by producto"
"0","order by porcent_perdida desc;"") "
"0",""
"0"," "
"0",""
"0","library(plotly) "
"0",""
"0"," "
"0",""
"0","plotter <- plot_ly( "
"0",""
"0","x = ~datos$producto, "
"0",""
"0","y = ~datos$porcent_perdida, "
"0",""
"0","name = 'Productos declarados', type = 'bar', "
"0",""
"0","marker = list(color = '#68912B', "
"0",""
"0","              line = list(color = '#AB7A5A', "
"0",""
"0","                                  width = 1))) %>% "
"0",""
"0","layout( title=(""""), "
"0",""
"0","yaxis = list(title = ""Porcentaje del desperdicio""), "
"0","xaxis = list(title = ""Producto"", categoryorder = ""total descending""), "
"0",""
"0","#margin = list(b = 100), "
"0",""
"0","barmode = 'group' ) "
"0",""
"0","plotter "
